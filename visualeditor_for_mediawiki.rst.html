<div class="highlight"><pre><span class="gh">ä¸ºMediaWikiå®‰è£…å¯è§†åŒ–ç¼–è¾‘å™¨</span>
<span class="gh">=========================================</span>

<span class="nc">:slug:</span> <span class="nf">visualeditor_for_mediawiki</span>
<span class="nc">:lang:</span> <span class="nf">zh</span>
<span class="nc">:date:</span> <span class="nf">2015-01-17 09:35</span>
<span class="nc">:tags:</span> <span class="nf">mediawiki,notes</span>
<span class="nc">:series:</span> <span class="nf">MediaWiki</span>

<span class="cp">.. PELICAN_BEGIN_SUMMARY</span>

ä¸ºMediaWikiå®‰è£…æ¥è‡ª <span class="s">`ç»´åŸºåª’ä½“åŸºé‡‘ä¼š </span><span class="si">&lt;https://www.mediawiki.org/wiki/VisualEditor&gt;</span><span class="s">`_</span> çš„ <span class="s">`å¯è§†åŒ–ç¼–è¾‘å™¨ </span><span class="si">&lt;https://www.mediawiki.org/wiki/VisualEditor&gt;</span><span class="s">`_</span> .

<span class="cp">.. PELICAN_END_SUMMARY</span>

<span class="p">..</span> <span class="ow">contents</span><span class="p">::</span>

<span class="gh">è¿ç»´åŸºç™¾ç§‘éƒ½è¦Holdä¸ä½å•¦~</span>
<span class="gh">-----------------------------</span>

    è®¸å¤šæ–°ç”¨æˆ·ä¸ä¼šç€æ‰‹å¤§å¹…åº¦ä¿®æ”¹ï¼Œè€Œåªæ˜¯åšäº›ç»†èŠ‚è°ƒæ•´ï¼Œä¸è¿‡ä»…ä»…é˜…è¯»æºä»£ç å°±å¿…é¡»å­¦æ ‡è®°è¯­è¨€äº†ã€‚å½“æˆ‘ä»¬çš„ç”¨æˆ·åœ¨æ¼”ç¤ºæ“ä½œæ—¶ï¼Œè¿™æŠŠä»–ä»¬å“èµ°äº†ã€‚

    æ—©åœ¨ 2004 å¹´ï¼Œç¤¾ç¾¤å¼€å§‹ä¸€å†è®¤è¯†åˆ°å¿…é¡»é‡‡ç”¨æ›´å¥½çš„ç¼–è¾‘æ–¹å¼ã€‚å› ä¸ºäººä»¬çš„è¯·æ±‚ï¼Œæ›´é‡è¦çš„æ˜¯ä»–ä»¬çš„éœ€è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘äº†å¯è§†åŒ–ç¼–è¾‘å™¨ã€‚

    Wiki æ ‡è®°è¯­è¨€è®©æ–°äººå®³æ€•ï¼Œè¿™ç§ç¨‹åº¦ä¼šéšç€å…¶ä»–ç«™ç‚¹çš„è¿ç¦»è€ŒåŠ å‰§ã€‚å¦‚æœæˆ‘ä»¬ä¸å¼€å‘å¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆå›¾è¡¨çš„èµ°åŠ¿ä¼šåœ¨æ¥ä¸‹æ¥äº”å¹´ä¸­å˜å¾—æ›´åŠ ç³Ÿç³•ã€‚

    -- <span class="s">`MediaWiki.org </span><span class="si">&lt;https://www.mediawiki.org/wiki/VisualEditor/Portal/Why/zh&gt;</span><span class="s">`_</span>

æ‰€ä»¥ä»–ä»¬æ‰ <span class="na">:del:</span><span class="nv">`ç—›å®šæ€ç—›`</span> å†³å®šå¼€å‘å¯è§†åŒ–ç¼–è¾‘å™¨ä¹ˆğŸ˜‚

<span class="gh">å¼€å§‹ä¹‹å‰-æ£€æŸ¥ä¸€ä¸‹è¦æ±‚</span>
<span class="gh">------------------------------</span>

å¯è§†åŒ–ç¼–è¾‘å™¨(ä¸‹é¢å°±è¯´VisualEditorå‘—~)è¿˜éœ€è¦ä¸€ä¸ªå«
<span class="s">`Parsoid </span><span class="si">&lt;https://www.mediawiki.org/wiki/VisualEditor/Portal/Why/zh&gt;</span><span class="s">`_</span>
çš„ç¨‹åºæ¥æ‰¿æ‹…æŠŠwikiæ ‡è®°è½¬åŒ–æˆhtmlçš„ä»»åŠ¡å•¦(çœ‹ä¸‹å›¾)~,æ‰€ä»¥éœ€è¦æœåŠ¡å™¨æ¥è¿è¡Œå®ƒå‘~

<span class="p">..</span> <span class="ow">image</span><span class="p">::</span> images/Parsoid_HTML-RDFa_content_model.svg.png
   <span class="nc">:scale:</span> <span class="nf">50 %</span>
   <span class="nc">:alt:</span> <span class="nf">Parsoidçš„å·¥ä½œåŸç†</span>



<span class="gh">å®‰è£…Parsoid(Ubuntu 14+ / Debian 7+ )</span>
<span class="gh">--------------------------------------</span>

ä¸Šæ¸¸çš„æŒ‡å—åœ¨è¿™(å¥½å¥½å­¦è‹±è¯­å‘—~) <span class="s">`&lt;https://www.mediawiki.org/wiki/Parsoid/Setup&gt;`_</span>

Ubuntuå’ŒDebianç³»ç»Ÿçš„è¯ç›´æ¥æ·»åŠ MediaWiki.orgçš„è½¯ä»¶æºç„¶åé€šè¿‡aptå®‰è£…å°±å¥½äº†å•¦~

é¦–å…ˆæ·»åŠ MediaWiki.orgçš„GPGå…¬é’¥:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo apt-key advanced --keyserver keys.gnupg.net --recv-keys 664C383A3566A3481B942F007A322AC6E84AFDD2

ç„¶åæ·»åŠ Parsoidæº:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo <span class="nb">echo</span> <span class="s2">&quot;deb https://releases.wikimedia.org/debian jessie-mediawiki main&quot;</span> &gt; /etc/apt/sources.list.d/parsoid.list

å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get install curl parsoid

ç„¶åçœ‹ä¸‹ä¸‹é¢ä¸€èŠ‚çš„å†…å®¹ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å‘—~

<span class="gh">å…¶å®ƒç³»ç»Ÿ?æ‰‹åŠ¨å®‰è£…å‘—~</span>
<span class="gh">---------------------------------</span>

ä¸Šæ¸¸çš„æŒ‡å—åœ¨è¿™(è¿˜æ˜¯è¦å¥½å¥½å­¦è‹±è¯­å‘—~) <span class="s">`&lt;https://www.mediawiki.org/wiki/Parsoid/Developer_Setup&gt;`_</span>

é¦–å…ˆæ±è¦è£…ä¸ŠNodejs(&gt;0.8,å»ºè®®0.10æˆ–æ›´æ–°çš„ç‰ˆæœ¬å‘~),è¿˜æœ‰git.
å…·ä½“çš„å®‰è£…æ–¹æ³•ä¸ºäº†é¿å…é™ä½æ­£äº¤æ€§ <span class="na">:del:</span><span class="nv">`(å…¶å®æ˜¯ç³»ç»Ÿå¤ªå¤šä¸å¥½å†™......)`</span>,å°±éº»çƒ¦æ±è‡ªå·±å»æ‰¾äº†å‘~

    ã€Œå‘µã€‚å’±æ˜¯è´¤ç‹¼ï¼Œä¸æ˜¯ç¥å‘ã€‚å¦‚æœæ±å¼€å§‹ä¼šæœŸå¾…èµ·å’±èƒ½å¤Ÿæ³„éœ²å¤©æœºç»™æ±ï¼Œé‚£å’±å°±å¾—ä»æ±çœ¼å‰æ¶ˆå¤±äº†å‘—ã€‚ã€



<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    node --version <span class="c1"># å¦‚æœæ˜¯Debianæˆ–Ubuntu ,è¾“å…¥ nodejs --version</span>

ç„¶åç”¨gitå…‹éš†ç‰ˆæœ¬åº“å‘—~

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    git clone https://gerrit.wikimedia.org/r/p/mediawiki/services/parsoid

ç”¨npmå®‰è£…ä¸Šç›¸åº”çš„ä¾èµ–:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    npm install

ç„¶åçœ‹ä¸‹é¢ä¸€èŠ‚çš„å†…å®¹ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å‘—~

<span class="gh">ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
<span class="gh">------------------------------</span>

    å¦‚æœæ˜¯é€šè¿‡è½¯ä»¶æºå®‰è£…çš„,é…ç½®æ–‡ä»¶ä½äº <span class="na">:code:</span><span class="nv">`/etc/mediawiki/parsoid/settings.js`</span>

    å¦‚æœæ˜¯é€šè¿‡gitä¸‹è½½çš„,ä»parsoidç›®å½•ä¸­å…ˆå¤åˆ¶ä¸€ä»½æ ·ä¾‹å‡ºæ¥å‘—~

<span class="p">    ..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

        cp localsettings.js.example localsettings.js

æ‰“å¼€é…ç½®æ–‡ä»¶,æ‰¾åˆ°è¿™ä¸€æ®µå†…å®¹,ç„¶åæ”¹å®ƒ~:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">javascript</span>

    <span class="nx">parsoidConfig</span><span class="p">.</span><span class="nx">setMwApi</span><span class="p">({</span>
        <span class="c1">// The &quot;prefix&quot; is the name given to this wiki configuration in the</span>
        <span class="c1">// (deprecated) Parsoid v1 API.</span>
        <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="c1">// optional</span>
        <span class="c1">// The &quot;domain&quot; is used for communication with Visual Editor</span>
        <span class="c1">// and RESTBase.  It defaults to the hostname portion of</span>
        <span class="c1">// the `uri` property below, but you can manually set it</span>
        <span class="c1">// to an arbitrary string.</span>
        <span class="nx">domain</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="c1">// optional</span>
        <span class="c1">// This is the only required parameter:</span>
        <span class="c1">// the URL of you MediaWiki API endpoint.</span>
        <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://localhost/w/api.php&#39;</span>
        <span class="p">});</span>

å…¶ä¸­&quot;uri&quot;å¯¹åº”æ±çš„wikiçš„api.phpçš„ä½ç½®,&quot;domain&quot;æ˜¯æ±çš„åŸŸåå•¦~.&quot;prefix&quot;å¯ä»¥è‡ªå·±èµ·ä¸€ä¸ª(åæ­£å› ä¸ºæ¢äº†APIä¹Ÿæ²¡ç”¨å•¦~,ä¸è¿‡æµ‹è¯•æ—¶å¯èƒ½ç”¨å¾—åˆ°)

<span class="gh">å¯åŠ¨æœåŠ¡</span>
<span class="gh">-------------------------</span>

<span class="gh">-------------------------</span>
<span class="gh">ä»è½¯ä»¶æºå®‰è£…çš„?</span>
<span class="gh">-------------------------</span>

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo systemctl start parsoid <span class="c1"># Debian Jessie ,ç”¨Systemdå¯åŠ¨</span>

    sudo service parsoid start <span class="c1"># Debian Wheezy æˆ–Ubuntu ,ç”¨init.dè„šæœ¬å¯åŠ¨.</span>

å¦‚æœæ±ä¸æ˜¯é€šè¿‡è¿œç¨‹è®¿é—®æ‰§è¡Œçš„å‘½ä»¤,å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€ <span class="na">:code:</span><span class="nv">`http://localhost:8142`</span> æ¥è¿›è¡Œæµ‹è¯•.è¯•ç€åŠ è½½ <span class="na">:code:</span><span class="nv">`http://localhost:8142/æ±è®¾ç½®çš„å‰ç¼€/æ±çš„wikiä¸Šçš„ä¸€ä¸ªé¡µé¢`</span> è¯•è¯•å‘—~

<span class="gh">-------------------------</span>
<span class="gh">ç”¨gitå®‰è£…çš„?</span>
<span class="gh">-------------------------</span>

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    npm start

æˆ–è€…:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    node bin/server.js

å¯ä»¥ç”¨screenä¸€ç±»çš„å·¥å…·è®©Parsoidåœ¨åå°è¿è¡Œ~

å¦‚æœæ±ä¸æ˜¯é€šè¿‡è¿œç¨‹è®¿é—®æ‰§è¡Œçš„å‘½ä»¤,å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€ <span class="na">:code:</span><span class="nv">`http://localhost:8000`</span> æ¥è¿›è¡Œæµ‹è¯•.è¯•ç€åŠ è½½ <span class="na">:code:</span><span class="nv">`http://localhost:8000/æ±è®¾ç½®çš„å‰ç¼€/æ±çš„wikiä¸Šçš„ä¸€ä¸ªé¡µé¢`</span> è¯•è¯•å‘—~

<span class="gh">------------------------------------</span>
<span class="gh">ä¿®æ”¹ç›‘å¬åœ°å€ä¾¿äºè¿œç¨‹æµ‹è¯•</span>
<span class="gh">------------------------------------</span>

æ”¹è¿™ä¸€æ®µ:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">javascript</span>

    <span class="c1">// Allow override of port/interface:</span>
    <span class="c1">//parsoidConfig.serverPort = 8142;</span>
    <span class="c1">//parsoidConfig.serverInterface = &#39;127.0.0.1&#39;;</span>

åæ³¨é‡Šæœ€åä¸€è¡Œå¹¶æ”¹æˆ0.0.0.0,å°±å¯ä»¥é€šè¿‡ <span class="na">:code:</span><span class="nv">`http://æœåŠ¡å™¨çš„IPåœ°å€:8142`</span> è®¿é—®å•¦~

<span class="gh">å®‰è£…VisualEditoræ‰©å±•</span>
<span class="gh">--------------------------------------</span>

ä¸Šæ¸¸çš„æŒ‡å—åœ¨è¿™: <span class="s">`&lt;https://www.mediawiki.org/wiki/Extension:VisualEditor&gt;`_</span>

é¦–å…ˆä» <span class="s">`è¿™é‡Œ </span><span class="si">&lt;https://www.mediawiki.org/wiki/Special:ExtensionDistributor/VisualEditor&gt;</span><span class="s">`_</span> è·å¾—æ‰©å±•ç„¶åä¸Šä¼ åˆ°æ±çš„wikiä¸Šçš„extensionsç›®å½•å‘—~

ç„¶åä¿®æ”¹æ±çš„LocalSettings.php:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> php
    $wgVirtualRestConfig[&#39;modules&#39;][&#39;parsoid&#39;] = array(
    // URL to the Parsoid instance
    // Use port 8142 if you use the Debian package
    // Parsoid è¿è¡Œçš„ä½ç½®,å¦‚æœæ˜¯ä»è½¯ä»¶æºå®‰è£…çš„,é»˜è®¤è®¾ç½®æ˜¯&#39;http://localhost:8142&#39;
    &#39;url&#39; =&gt; &#39;http://localhost:8000&#39;,
    // Parsoid &quot;domain&quot;, see below (optional)
    // æ±åœ¨Parsoidä¸­è®¾ç½®çš„&quot;domain&quot;å€¼å‘~
    &#39;domain&#39; =&gt; &#39;localhost&#39;,
    // Parsoid &quot;prefix&quot;, see below (optional)
    // æ±åœ¨Parsoidä¸­è®¾ç½®çš„&quot;prefix&quot;å€¼å‘~
    &#39;prefix&#39; =&gt; &#39;localhost&#39;
    );

    require_once &quot;$IP/extensions/VisualEditor/VisualEditor.php&quot;;

    // åæ³¨é‡Šä¸‹ä¸€è¡Œæ¥é»˜è®¤å¯ç”¨å¯è§†åŒ–ç¼–è¾‘å™¨
    #$wgDefaultUserOptions[&#39;visualeditor-enable&#39;] = 1;

    // åæ³¨é‡Šä¸‹ä¸€è¡Œæ¥å¯ç”¨æµ‹è¯•ä¸­çš„åŠŸèƒ½
    #$wgDefaultUserOptions[&#39;visualeditor-enable-experimental&#39;] = 1;

    //åœ¨é™¤äº†ä¸»åå­—ç©ºé—´ä»¥å¤–çš„åå­—ç©ºé—´ä¸­ä¹Ÿå¯ç”¨å¯è§†åŒ–ç¼–è¾‘å™¨(ä¸‹é¢çš„ä¾‹å­æ˜¯ç”¨æˆ·åå­—ç©ºé—´)
    $wgVisualEditorNamespaces=array_merge($wgContentNamespaces,array( NS_USER ));

å®Œæ•´çš„è®¾ç½®é€‰é¡¹å¯ä»¥åœ¨æ‰©å±•é¡µé¢ä¸Šæ‰¾åˆ°.

ç„¶ååœ¨æ±çš„wikiä¸Šè¯•è¯•çœ‹å‘—~

<span class="p">..</span> <span class="ow">image</span><span class="p">::</span> images/visualeditor-test.png
   <span class="nc">:scale:</span> <span class="nf">50 %</span>
   <span class="nc">:alt:</span> <span class="nf">Parsoidçš„å·¥ä½œåŸç†</span>
</pre></div>
