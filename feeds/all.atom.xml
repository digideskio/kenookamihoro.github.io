<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>约伊兹的萌狼乡手札</title><link href="https://blog.yoitsu.moe/" rel="alternate"></link><link href="https://blog.yoitsu.moe/feeds/all.atom.xml" rel="self"></link><id>https://blog.yoitsu.moe/</id><updated>2015-01-17T09:35:00+08:00</updated><entry><title>为MediaWiki安装可视化编辑器</title><link href="https://blog.yoitsu.moe/visualeditor_for_mediawiki.html" rel="alternate"></link><updated>2015-01-17T09:35:00+08:00</updated><author><name>ホロ</name></author><id>tag:blog.yoitsu.moe,2015-01-17:visualeditor_for_mediawiki.html</id><summary type="html">&lt;!-- PELICAN_BEGIN_SUMMARY --&gt;
&lt;p&gt;为MediaWiki安装来自 &lt;a class="reference external" href="https://www.mediawiki.org/wiki/VisualEditor"&gt;维基媒体基金会&lt;/a&gt; 的 &lt;a class="reference external" href="https://www.mediawiki.org/wiki/VisualEditor"&gt;可视化编辑器&lt;/a&gt; .&lt;/p&gt;
&lt;!-- PELICAN_END_SUMMARY --&gt;
&lt;div class="section" id="hold"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id10"&gt;连维基百科都要Hold不住啦~&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;许多新用户不会着手大幅度修改，而只是做些细节调整，不过仅仅阅读源代码就必须学标记语言了。当我们的用户在演示操作时，这把他们吓走了。&lt;/p&gt;
&lt;p&gt;早在 2004 年，社群开始一再认识到必须采用更好的编辑方式。因为人们的请求，更重要的是他们的需要，所以我们开发了可视化编辑器。&lt;/p&gt;
&lt;p&gt;Wiki 标记语言让新人害怕，这种程度会随着其他站点的迁离而加剧。如果我们不开发可视化编辑器，那么图表的走势会在接下来五年中变得更加糟糕。&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://www.mediawiki.org/wiki/VisualEditor/Portal/Why/zh"&gt;MediaWiki.org&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以他们才 &lt;del&gt;痛定思痛&lt;/del&gt; 决定开发可视化编辑器么😂&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id11"&gt;开始之前-检查一下要求&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;可视化编辑器(下面就说VisualEditor呗~)还需要一个叫
&lt;a class="reference external" href="https://www.mediawiki.org/wiki/VisualEditor/Portal/Why/zh"&gt;Parsoid&lt;/a&gt;
的程序来承担把wiki标记转化成html的任务啦(看下图)~,所以需要服务器来运行它呐~&lt;/p&gt;
&lt;object data="images/Parsoid_HTML-RDFa_content_model.svg" type="image/svg+xml"&gt;
Parsoid的工作原理&lt;/object&gt;
&lt;/div&gt;
&lt;div class="section" id="parsoid-ubuntu-14-debian-7"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;安装Parsoid(Ubuntu 14+ / Debian 7+ )&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;上游的指南在这(好好学英语呗~) &lt;a class="reference external" href="https://www.mediawiki.org/wiki/Parsoid/Setup"&gt;https://www.mediawiki.org/wiki/Parsoid/Setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ubuntu和Debian系统的话直接添加MediaWiki.org的软件源然后通过apt安装就好了啦~&lt;/p&gt;
&lt;p&gt;首先添加MediaWiki.org的GPG公钥:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;sudo apt-key advanced --keyserver keys.gnupg.net --recv-keys 664C383A3566A3481B942F007A322AC6E84AFDD2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后添加Parsoid源:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;sudo &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;"deb https://releases.wikimedia.org/debian jessie-mediawiki main"&lt;/span&gt; &amp;gt; /etc/apt/sources.list.d/parsoid.list&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;安装需要的软件包:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;sudo apt-get update &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get install curl parsoid&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后看下下面一节的内容修改一下配置文件呗~&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id13"&gt;其它系统?手动安装呗~&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;上游的指南在这(还是要好好学英语呗~) &lt;a class="reference external" href="https://www.mediawiki.org/wiki/Parsoid/Developer_Setup"&gt;https://www.mediawiki.org/wiki/Parsoid/Developer_Setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先汝要装上Nodejs(&amp;gt;0.8,建议0.10或更新的版本呐~),还有git.
具体的安装方法为了避免降低正交性 &lt;del&gt;(其实是系统太多不好写......)&lt;/del&gt;,就麻烦汝自己去找了呐~&lt;/p&gt;
&lt;blockquote&gt;
「呵。咱是贤狼，不是神呐。如果汝开始会期待起咱能够泄露天机给汝，那咱就得从汝眼前消失了呗。」&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;node --version &lt;span class="c"&gt;# 如果是Debian或Ubuntu ,输入 nodejs --version&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后用git克隆版本库呗~&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;git clone https://gerrit.wikimedia.org/r/p/mediawiki/services/parsoid&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用npm安装上相应的依赖:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;npm install&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后看下面一节的内容修改一下配置文件呗~&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id5"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id14"&gt;修改配置文件&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;如果是通过软件源安装的,配置文件位于 &lt;code class="code"&gt;
/etc/mediawiki/parsoid/settings.js&lt;/code&gt;
&lt;/p&gt;
&lt;p&gt;如果是通过git下载的,从parsoid目录中先复制一份样例出来呗~&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;cp localsettings.js.example localsettings.js&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;打开配置文件,找到这一段内容,然后改它~:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span class="nx"&gt;parsoidConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setMwApi&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// The "prefix" is the name given to this wiki configuration in the&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// (deprecated) Parsoid v1 API.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nx"&gt;prefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'localhost'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// optional&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// The "domain" is used for communication with Visual Editor&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// and RESTBase.  It defaults to the hostname portion of&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// the `uri` property below, but you can manually set it&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// to an arbitrary string.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nx"&gt;domain&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'localhost'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// optional&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// This is the only required parameter:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="c1"&gt;// the URL of you MediaWiki API endpoint.&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="nx"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://localhost/w/api.php'&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;    &lt;span class="p"&gt;});&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中"uri"对应汝的wiki的api.php的位置,"domain"是汝的域名啦~."prefix"可以自己起一个(反正因为换了API也没用啦~,不过测试时可能用得到)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id15"&gt;启动服务&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="id7"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id16"&gt;从软件源安装的?&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;sudo systemctl start parsoid &lt;span class="c"&gt;# Debian Jessie ,用Systemd启动&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;sudo service parsoid start &lt;span class="c"&gt;# Debian Wheezy 或Ubuntu ,用init.d脚本启动.&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果汝不是通过远程访问执行的命令,可以在浏览器上打开 &lt;code class="code"&gt;
http://localhost:8142&lt;/code&gt;
 来进行测试.试着加载 &lt;code class="code"&gt;
http://localhost:8142/汝设置的前缀/汝的wiki上的一个页面&lt;/code&gt;
 试试呗~&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="git"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id17"&gt;用git安装的?&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;npm start&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;或者:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;node bin/server.js&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以用screen一类的工具让Parsoid在后台运行~&lt;/p&gt;
&lt;p&gt;如果汝不是通过远程访问执行的命令,可以在浏览器上打开 &lt;code class="code"&gt;
http://localhost:8000&lt;/code&gt;
 来进行测试.试着加载 &lt;code class="code"&gt;
http://localhost:8000/汝设置的前缀/汝的wiki上的一个页面&lt;/code&gt;
 试试呗~&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id8"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id18"&gt;修改监听地址便于远程测试&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;改这一段:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;&lt;span class="c1"&gt;// Allow override of port/interface:&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;//parsoidConfig.serverPort = 8142;&lt;/span&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;span class="c1"&gt;//parsoidConfig.serverInterface = '127.0.0.1';&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;反注释最后一行并改成0.0.0.0,就可以通过 &lt;code class="code"&gt;
http://服务器的IP地址:8142&lt;/code&gt;
 访问啦~&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="visualeditor"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id19"&gt;安装VisualEditor扩展&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;上游的指南在这: &lt;a class="reference external" href="https://www.mediawiki.org/wiki/Extension:VisualEditor"&gt;https://www.mediawiki.org/wiki/Extension:VisualEditor&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先从 &lt;a class="reference external" href="https://www.mediawiki.org/wiki/Special:ExtensionDistributor/VisualEditor"&gt;这里&lt;/a&gt; 获得扩展然后上传到汝的wiki上的extensions目录呗~&lt;/p&gt;
&lt;p&gt;然后修改汝的LocalSettings.php:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="code-line"&gt;require_once "$IP/extensions/VisualEditor/VisualEditor.php";&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// 反注释下一行来默认启用可视化编辑器&lt;/span&gt;
&lt;span class="code-line"&gt;#$wgDefaultUserOptions['visualeditor-enable'] = 1;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;// 反注释下一行来启用测试中的功能&lt;/span&gt;
&lt;span class="code-line"&gt;#$wgDefaultUserOptions['visualeditor-enable-experimental'] = 1;&lt;/span&gt;
&lt;span class="code-line"&gt;&lt;/span&gt;
&lt;span class="code-line"&gt;//在除了主名字空间以外的名字空间中也启用可视化编辑器(下面的例子是用户名字空间)&lt;/span&gt;
&lt;span class="code-line"&gt;$wgVisualEditorNamespaces=array_merge($wgContentNamespaces,array( NS_USER ));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;完整的设置选项可以在扩展页面上找到.&lt;/p&gt;
&lt;p&gt;然后在汝的wiki上试试看呗~&lt;/p&gt;
&lt;img alt="Parsoid的工作原理" class="img-responsive" src="images/visualeditor-test.png"/&gt;
&lt;/div&gt;
</summary><category term="mediawiki"></category><category term="notes"></category></entry><entry><title>新的"约伊兹的萌狼乡手札"诞生啦~</title><link href="https://blog.yoitsu.moe/new_yoitsu_birth.html" rel="alternate"></link><updated>2015-01-16T09:35:00+08:00</updated><author><name>ホロ</name></author><id>tag:blog.yoitsu.moe,2015-01-16:new_yoitsu_birth.html</id><summary type="html">&lt;!-- PELICAN_BEGIN_SUMMARY --&gt;
&lt;p&gt;就像标题描述的一样，新的"约伊兹的萌狼乡手札"以Pelican之姿再次出发啦~&lt;/p&gt;
&lt;!-- PELICAN_END_SUMMARY --&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id10"&gt;为啥要重做？&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;原来的 &lt;a class="reference external" href="https://wiki.yoitsu.moe/"&gt;约伊兹的萌狼乡手札&lt;/a&gt; 是基于MediaWiki搭建的,但是MediaWiki的本来用途并不是来做博客的呐~,不过咱还是一直拖着......直到 &lt;a class="reference external" href="https://www.archlinux.org/news/php-70-packages-released/"&gt;Arch Linux 宣布PHP7进入官方软件仓库&lt;/a&gt; ,咱升级以后两个关键的RSS扩展都坏掉啦~(应该都知道RSS对于博客型网站的重要性呗~),于是咱痛定思痛决定升级😂&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pelican"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id11"&gt;为啥是Pelican?&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;主要的原因是 &lt;del&gt;人生赢家&lt;/del&gt; &lt;a class="reference external" href="/links.html#farseerfc"&gt;farseerfc&lt;/a&gt; 用的也是Pelican，这样咱可以照着他的经历少走一些弯路......&lt;/p&gt;
&lt;p&gt;为啥不用Hexo,Ghost一类的博客系统呢?因为咱不太会设置Node.js(想当初给MediaWiki装可视化编辑器就折腾了半天)😂😂😂&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;那么有哪些问题咧?&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;首先Pelican用的标记语言是rst(重组的文本)或是MarkDown,不过看情况Markdown是刚加入进来的,处理的还不够好,就先用rst呗~&lt;/p&gt;
&lt;p&gt;然而咱并不会rst的语法......只好找来个 &lt;a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html"&gt;语法指南&lt;/a&gt; 先照着看......&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id13"&gt;关于旧站的打算?&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;介于原来的网站也是咱折腾了一阵子才出来的,于是决定先留着.(这个新站的评论要靠它呐~)&lt;/p&gt;
&lt;p&gt;咱以后也会继续折腾MediaWiki,顺便在这记下来一些过程和经验呗~&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id7"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id14"&gt;关于评论?&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;目前的计划是用 &lt;a class="reference external" href="https://wiki.yoitsu.moe/"&gt;https://wiki.yoitsu.moe/&lt;/a&gt; 的Feedback名字空间或是Github issues来完成呐~汝问咱为啥不用Disqus?&lt;/p&gt;
&lt;p&gt;受 &lt;a class="reference external" href="/links.html#fiveyellowmice"&gt;fiveyellowmice&lt;/a&gt; 的影响,咱不会试图去收集汝的隐私呐~&lt;/p&gt;
&lt;p&gt;这个网站回放在咱自己的服务器上,然而由于开了Cloudflare的CDN又没安装插件,咱的服务器日志上的IP地址全部是来自Cloudflare的......&lt;/p&gt;
&lt;p&gt;咱还使用Google Analytics ，它收集像访问人数和浏览器类型之类的信息.而且(照Google的说法),它使用匿名标识符来区分每一个人.所以汝最好去看看 &lt;a class="reference external" href="https://www.google.com/intl/zh-CN/policies/"&gt;Google 的隐私政策&lt;/a&gt; .如果汝真的不想让咱知道的话, &lt;a class="reference external" href="https://www.torproject.org/"&gt;用Tor 呗~&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里(不含用于评论的wiki.yoitsu.moe)本身不会创建任何Cookie,汝看到的Cookie是CloudFlare和Google Analytics创建的,和咱没啥关系.&lt;/p&gt;
&lt;p&gt;用于评论的 &lt;a class="reference external" href="https://wiki.yoitsu.moe/"&gt;原约伊兹的萌狼乡手札&lt;/a&gt; 是基于MediaWiki搭建的,所以匿名用户的IP地址会显示在编辑历史中(这是MediaWiki软件自身的设定,毕竟人家的本意是做开放的wiki不是?).如果汝使用账户登录的话,便会在汝的浏览器上设置Cookies呐~(登录用户的IP地址轻易不会让人知道的啦[#]_ )&lt;/p&gt;
&lt;p&gt;当然啦,如果汝觉得便捷大于对隐私的关注的话,可以发个评论抱怨一下咱~&lt;/p&gt;
&lt;table class="footnote table-hover table-striped table docutils" frame="void" id="id9" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;/col&gt;&lt;col&gt;&lt;/col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;[1]&lt;/td&gt;&lt;td&gt;通过Checkuser扩展可以查出注册用户进行编辑时的IP地址,然而咱并没有......&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;作为新博客的第一篇博文就说到这里,咱具体是怎么做的 &lt;del&gt;请听下回分解&lt;/del&gt; 😂😂😂&lt;/p&gt;
&lt;/div&gt;
</summary><category term="yoitsu"></category><category term="pelican"></category><category term="blog"></category></entry></feed>