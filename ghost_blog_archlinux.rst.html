<div class="highlight"><pre><span></span><span class="gh">åœ¨ Arch Linux ä¸Šå®‰è£… Ghost åšå®¢ç³»ç»Ÿ</span>
<span class="gh">===================================================</span>

<span class="nc">:slug:</span> <span class="nf">ghost_blog_archlinux</span>
<span class="nc">:lang:</span> <span class="nf">zh</span>
<span class="nc">:date:</span> <span class="nf">2016-02-14</span>
<span class="nc">:tags:</span> <span class="nf">Arch Linux,partner</span>
<span class="nc">:series:</span> <span class="nf">Arch Linux</span>

<span class="cp">.. PELICAN_BEGIN_SUMMARY</span>

å…ˆç¥å¤§å®¶ <span class="na">:ruby:</span><span class="nv">`æƒ…äººèŠ‚|çƒ§çƒ¤èŠ‚`</span> å¿«ä¹~ (2333

<span class="na">:del:</span><span class="nv">`ä¸ºäº†è®©æ—…ä¼´å‘å‘ç‰¢éªš,å°±è£…äº†ä¸€ä¸ª Ghost åšå®¢ç³»ç»Ÿå’¯~`</span>

<span class="cp">.. PELICAN_END_SUMMARY</span>

<span class="p">..</span> <span class="ow">contents</span><span class="p">::</span>

<span class="gh">æ±è¿å•¥æ˜¯ Ghost éƒ½ä¸çŸ¥é“?</span>
<span class="gh">-----------------------------------------------------------------</span>

    Ghostæ˜¯ç”¨JavaScriptç¼–å†™çš„åšå®¢å¹³å°ï¼ŒåŸºäºMITè®¸å¯è¯å¼€æ”¾æºä»£ç ã€‚Ghostçš„è®¾è®¡ä¸»æ—¨æ˜¯ç®€åŒ–ä¸ªäººç½‘ç«™å‘å¸ƒä»¥åŠç½‘ä¸Šå‡ºç‰ˆçš„è¿‡ç¨‹ã€‚

    Ghostæ˜¯ä¸€æ¬¾ä¸ªäººåšå®¢ç³»ç»Ÿï¼Œå®ƒæ˜¯ä½¿ç”¨Node.jsè¯­è¨€å’ŒMySQLæ•°æ®åº“å¼€å‘çš„ï¼ŒåŒæ—¶æ”¯æŒMySQLã€MariaDBã€SQLiteå’ŒPostgreSQLã€‚ç”¨æˆ·å¯ä»¥åœ¨æ”¯æŒNode.jsçš„æœåŠ¡å™¨ä¸Šä½¿ç”¨è‡ªå·±çš„åšå®¢ã€‚

    -- <span class="s">`Wikipedia ä¸Šçš„ &quot;Ghost (åšå®¢å¹³å°)&quot; æ¡ç›® </span><span class="si">&lt;https://zh.wikipedia.org/wiki/Ghost_%28%E5%8D%9A%E5%AE%A2%E5%B9%B3%E5%8F%B0%29&gt;</span><span class="s">`_</span>
    
ç®€å•æ¥è¯´,Ghost æ˜¯ä¸€å¥—åšå®¢å¹³å°,æ˜¯ä¸€å¥—åšå®¢å¹³å°,æ˜¯ä¸€å¥—åšå®¢å¹³å°! <span class="na">:del:</span><span class="nv">`(é‡è¦çš„äº‹æƒ…è¯´ä¸‰éğŸ˜‚ğŸ˜‚)`</span>

<span class="gh">è¦å®‰è£… Ghost éœ€è¦å•¥?</span>
<span class="gh">------------------------------------------------------------------</span>

å› ä¸º Ghost æ˜¯ç”¨ Node.js å†™æˆçš„,æ‰€ä»¥è¦å®‰è£… Ghost , æ±éœ€è¦å…ˆè£…ä¸Š Node.js å’Œ npm å‘—~

<span class="p">..</span> <span class="ow">alert-warning</span><span class="p">::</span>
    æˆªè‡³å†™è¿™ç¯‡æ–‡ç« æ—¶,Arch Linux å®˜æ–¹æºé‡Œ Node.js çš„ç‰ˆæœ¬æ˜¯ 5.6.0 ,è€Œ Ghost çš„è®¡åˆ’æ˜¯åªæ”¯æŒ Node.js çš„ <span class="na">:ruby:</span><span class="nv">`LTS|é•¿æœŸæ”¯æ´`</span> ç‰ˆæœ¬, è€Œ Node.js çš„é•¿æœŸæ”¯æ´ç‰ˆæœ¬æ˜¯ 0.10x,0.12xå’Œ4.2 .æ‰€ä»¥å˜›...... 
    
    è¿™é‡Œ(å’Œå’±åœ¨ AUR çš„ ghost è½¯ä»¶åŒ…é‡Œ)ç”¨åˆ°äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ <span class="na">:code:</span><span class="nv">`GHOST_NODE_VERSION_CHECK=false`</span> æ¥ä¸è®© ghost æ¥æ£€æŸ¥ node çš„ç‰ˆæœ¬,åœ¨ Node.js ä¸‹ä¸€ä¸ª LTS ç‰ˆæœ¬(6.x)å‡ºæ¥å‰å…ˆå‡‘åˆä¸€ä¸‹å‘—~
    

äºæ˜¯å…ˆå®‰è£… <span class="na">:package:</span><span class="nv">`nodejs`</span> å’Œ <span class="na">:package:</span><span class="nv">`npm`</span> :

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo pacman -S nodejs npm
    
å¦‚æœæ±è®¤ä¸ºè‡ªå·±çš„åšå®¢ä¼šåšçš„æ¯”è¾ƒå¤§,éœ€è¦ä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿçš„è¯,å’±æ¨è <span class="na">:package:</span><span class="nv">`mariadb`</span> å‘—~

<span class="gh">ä» AUR å®‰è£… Ghost</span>
<span class="gh">--------------------------------------------------------------------</span>
ç„¶åä» AUR å®‰è£… <span class="na">:aur:</span><span class="nv">`ghost`</span> (è¿™ä¸ªåŒ…æ˜¯å’±æ›´æ–°çš„,æœ‰é—®é¢˜å°½ç®¡ pia å’±~).

å¦‚æœæ±æœ‰ yaourt çš„è¯, <span class="na">:code:</span><span class="nv">`yaourt -S ghost`</span>

è¿™ä¼šæŠŠ ghost å®‰è£…åœ¨ <span class="na">:code:</span><span class="nv">`/srv/ghost/`</span> ç›®å½•,ç”±äºåˆ›å»ºçš„ ghost ç”¨æˆ·ä¸èƒ½é€šè¿‡ shell ç™»å½•,è¦ä¿®æ”¹è¿™ä¸ªç›®å½•çš„æ–‡ä»¶çš„è¯:

<span class="m">*</span> ä¿®æ”¹ <span class="na">:code:</span><span class="nv">`/etc/passwd`</span> æ–‡ä»¶:

    ghost:x:738:738::/srv/ghost:/usr/bin/nologin
    
    æŠŠ <span class="na">:code:</span><span class="nv">`/usr/bin/nologin`</span> æ¢æˆ <span class="na">:code:</span><span class="nv">`/bin/bash`</span> ,ä¿å­˜.
    
    è¿™æ ·ä»¥åå¯ä»¥é€šè¿‡ <span class="na">:code:</span><span class="nv">`sudo su ghost`</span> åˆ‡æ¢åˆ° ghost ç”¨æˆ·å¯¹ /srv/ghost ç›®å½•å†™å…¥äº†.
 
<span class="m">*</span> é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ä»¥ ghost ç”¨æˆ·è¿è¡Œä¸€æ¡å‘½ä»¤:
    
<span class="p">    ..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>
        
        <span class="c1"># su åé¢çš„ -s å‚æ•°å¯ä»¥åˆ¶å®šåˆ‡æ¢ç”¨æˆ·åè¿è¡Œçš„ shell , </span>
        <span class="c1"># -c å‚æ•°å¯ä»¥æŒ‡å®šè¦è¿è¡Œçš„å‘½ä»¤.</span>
        
        sudo su ghost -s /bin/bash -c <span class="s2">&quot;æ­¤å¤„æ˜¯æ±çš„å‘½ä»¤,è®°å¾—å¸¦ä¸Šå¼•å·&quot;</span>

<span class="gh">é€šè¿‡æºä»£ç å®‰è£… Ghost </span>
<span class="gh">--------------------------------------------------------------------</span>
é¦–å…ˆæŠŠ ghost çš„æºä»£ç ä¸‹è½½ä¸‹æ¥å¹¶è§£å¼€:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash </span>
    
    <span class="c1"># è¿™æ—¶æœ€æ–°çš„ç‰ˆæœ¬æ˜¯0.7.6.</span>
    wget https://ghost.org/zip/ghost-0.7.6.zip
    unzip ghost-0.7.6.zip 
    <span class="nb">cd</span> ghost-0.7.6
    
æ¥ä¸‹æ¥é€šè¿‡ npm å®‰è£…éœ€è¦çš„ä¾èµ–,å› ä¸ºä¸Šé¢çš„æç¤ºå˜›~

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash </span>

    <span class="nv">GHOST_NODE_VERSION_CHECK</span><span class="o">=</span><span class="nb">false</span> npm install
    
<span class="gh">ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
<span class="gh">---------------------------------------------------------------------</span>

å¦‚æœæ˜¯é€šè¿‡ AUR å®‰è£…çš„,é…ç½®æ–‡ä»¶ä½äº <span class="na">:code:</span><span class="nv">`/srv/ghost/config.js`</span>

å¦‚æœæ˜¯é€šè¿‡æºä»£ç å®‰è£…çš„,ä»ç›®å½•ä¸­å…ˆå¤åˆ¶ä¸€ä»½æ ·ä¾‹å‡ºæ¥å‘—~

<span class="p">    ..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

        cp config.example.js config.js
        

è¿™é‡Œçš„ä¾‹å­æ˜¯ä¿®æ”¹ <span class="na">:code:</span><span class="nv">`Production`</span> ä¸€èŠ‚
(è¿™ä¸€èŠ‚æ˜¯æ±çš„ Ghost å®é™…è¿è¡Œæ—¶çš„é…ç½®,ä¸‹é¢çš„ Development ä¸€èŠ‚æ˜¯å¼€å‘æ—¶çš„é…ç½®)

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">javascript</span>

    <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// ### Production</span>
        <span class="c1">// When running Ghost in the wild, use the production environment.</span>
        <span class="c1">// Configure your URL and mail settings here</span>
        <span class="nx">production</span><span class="o">:</span> <span class="p">{</span>
            <span class="c1">// æ±çš„ç½‘å€?</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost&#39;</span><span class="p">,</span>
            <span class="nx">mail</span><span class="o">:</span> <span class="p">{},</span>
            <span class="c1">// æ±æƒ³ä½¿ç”¨é‚£ç§æ•°æ®åº“? </span>
            <span class="c1">// ä¸‹é¢çš„ä¾‹å­æ˜¯ sqlite3 æ•°æ®åº“,é…ç½®æ–‡ä»¶ä¸­è¿˜æœ‰è®¾ç½® MariaDB æ•°æ®åº“ çš„æ ·ä¾‹</span>
            <span class="nx">database</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">client</span><span class="o">:</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span>
                <span class="nx">connection</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">filename</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;/content/data/ghost.db&#39;</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="nx">debug</span><span class="o">:</span> <span class="nx">falseProduction</span>
            <span class="p">},</span>
    
            <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                <span class="nx">port</span><span class="o">:</span> <span class="s1">&#39;2368&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>

<span class="gh">å¦‚æœæ±çš„ Ghost å’Œæ±è¿›è¡Œæ“ä½œçš„ç”µè„‘æ˜¯åŒä¸€ä¸ª</span>
<span class="gh">------------------------------------------------</span>

é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æµ‹è¯•æ±çš„ Ghost å‘—~

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    <span class="nb">cd</span> /path/to/ghost
    <span class="nv">GHOST_NODE_VERSION_CHECK</span><span class="o">=</span><span class="nb">false</span>
    
å¦‚æœæ±æ˜¯ä» AUR å®‰è£…çš„,å¯ä»¥é€šè¿‡ Systemd æ¥å¯åŠ¨

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">bash</span>

    sudo systemctl start ghost
    
ç°åœ¨æ‰“å¼€ <span class="na">:code:</span><span class="nv">`http://localhost:2368`</span> çœ‹çœ‹æ•ˆæœå‘—~

<span class="gh">å¦‚æœæ±çš„ Ghost å’Œæ±è¿›è¡Œæ“ä½œçš„ç”µè„‘ä¸æ˜¯åŒä¸€ä¸ª</span>
<span class="gh">-------------------------------------------------------</span>

æ¯”å¦‚æ±åœ¨ VPS ä¸Šå®‰è£…äº† Ghost,å°±éœ€è¦ç”¨ä¸€ä¸ª webæœåŠ¡å™¨é€šè¿‡åå‘ä»£ç†æ¥è®¿é—®å‘—~

é¦–å…ˆä¿®æ”¹ <span class="na">:code:</span><span class="nv">`config.js`</span> æŠŠ Production ä¸­çš„ URL æ¢æˆæ±çš„ç½‘å€å•¦~

å¦‚æœæ±åœ¨ç”¨ Nginx, æŠŠè¿™ä¸€æ®µå¢åŠ åˆ°æ±çš„ <span class="na">:code:</span><span class="nv">`server`</span> å—ä¸­:

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">text</span>

     location / {
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header Host $http_host;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_pass http://127.0.0.1:2368;
           # æ±çš„æ›´å¤šè‡ªå®šä¹‰è®¾ç½®
     }
     
å¦‚æœæ±åœ¨ç”¨ Apache, æŠŠä¸‹é¢ä¸€æ®µæ·»åŠ åˆ°æ±çš„ httpd.conf çš„ vhost æ®µä¸­(é¦–å…ˆè¦å¯ç”¨ mod_proxy æ¨¡å—~):

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">text</span>

    ProxyPass / http://localhost:2368/
    ProxyPassReverse / http://localhost:2368/
    ProxyHTMLURLMap http://localhost:2368/ /
    RequestHeader set X-Forwarded-For $proxy_add_x_forwarded_for
    RequestHeader set Host $host
    RequestHeader set X-Forwarded-Proto $scheme	


ç„¶åé‡æ–°å¯åŠ¨ ghost å’Œ web æœåŠ¡å™¨ä»¥åè¯•è¯•é€šè¿‡æ±çš„ç½‘å€è®¿é—®?

æ‰“å¼€ <span class="na">:code:</span><span class="nv">`http://æ±çš„ghostç½‘å€/ghost/`</span> å¼€å§‹è®¾ç½®æ±çš„ Ghost åšå®¢å‘—~

<span class="gh">å‚è€ƒèµ„æ–™</span>
<span class="gh">----------------------------------------</span>

<span class="m">*</span> <span class="s">`Ghost Blog æ–‡æ¡£ </span><span class="si">&lt;http://support.ghost.org/developers&gt;</span><span class="s">`_</span>
<span class="m">*</span> <span class="s">`Apache httpd mod_proxy æ–‡æ¡£ </span><span class="si">&lt;http://httpd.apache.org/docs/2.4/mod/mod_proxy.html&gt;</span><span class="s">`_</span>
</pre></div>
